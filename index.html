<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>dpmerchant - 点评管家jsBridge</title>

    <link href="stylesheets/screen.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" type="text/css" media="print" />
    <script src="javascripts/contrib/jquery-2.1.4.min.js" type="text/javascript"></script>
      <script src="javascripts/all.js" type="text/javascript"></script>

      <script>
        $(function() {
          setupLanguages(["javascript"]);
        });
      </script>
  </head>

  <body class="index">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="images/logo.png" />
        <div class="lang-selector">
              <a href="#" data-language-name="javascript">javascript</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
        <ul class="toc-footer">
            <li><a href='https://github.com/efte/dpmerchant-doc'>项目地址</a></li>
            <li><a href='https://github.com/efte/dpmerchant-doc/issues'>Issue</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="概述">概述</h1>

<p>文档已经迁移到公司内部网络http://ed.f2e.dp/dpmerchant/doc</p>

          <h1 id="efte-js迁移指南">Efte.js迁移指南</h1>

<p>dpmerchant和点评管家内置了对现有功能的支持，对于原使用efte.js的业务，要求在3.6版本期间迁移到dpmerchant。</p>

<h2 id="能够直接迁移的方法">能够直接迁移的方法</h2>

<aside class="warning">为兼容老efte，请务必调用DPMer.ready</aside>

<table><thead>
<tr>
<th>efte.js方法</th>
<th>对应dpmerchant方法</th>
<th>说明</th>
</tr>
</thead><tbody>
<tr>
<td>action.back</td>
<td>closeWindow</td>
<td>直接替换</td>
</tr>
<tr>
<td>action.dismiss</td>
<td>closeWindow</td>
<td>直接替换；页面不能以modal模式打开</td>
</tr>
<tr>
<td>action.open</td>
<td>无</td>
<td>后续版本不再支持静态包，此方法不再有效</td>
</tr>
<tr>
<td>action.openUrl</td>
<td>openScheme</td>
<td>使用openScheme({url: “dpmer://web”, extra: { url: “http://example.com/some/path” }})使用webview打开对应url</td>
</tr>
<tr>
<td>action.reloadPage</td>
<td>无</td>
<td>使用location.reload()代替</td>
</tr>
<tr>
<td>actionRedirect</td>
<td>无</td>
<td>使用openScheme代替</td>
</tr>
<tr>
<td>openURLAction(iOS)</td>
<td>openScheme</td>
<td>使用openScheme({url: “dpmer://web”, extra: { url: “http://example.com/some/path” }})使用webview打开对应url</td>
</tr>
<tr>
<td>ajax</td>
<td>无</td>
<td>使用js发送（需要跨域的场合需添加CORS头部）</td>
</tr>
<tr>
<td>publish</td>
<td>weakPublish</td>
<td>直接替换</td>
</tr>
<tr>
<td>subscribe</td>
<td>weakSubscribe</td>
<td>直接替换</td>
</tr>
<tr>
<td>editPhoto</td>
<td>editPhoto</td>
<td>直接替换</td>
</tr>
<tr>
<td>gaLog/gaXXX</td>
<td>无</td>
<td>使用hippo打点代替</td>
</tr>
<tr>
<td>getEnv</td>
<td>getUA, getUserInfo, getVersion</td>
<td>视情况替换</td>
</tr>
<tr>
<td>setTitle</td>
<td>setTitle</td>
<td>直接替换</td>
</tr>
<tr>
<td>setTopRightButton</td>
<td>setRRButton</td>
<td>直接替换</td>
</tr>
<tr>
<td>setrightbaritem</td>
<td>setRRButton</td>
<td>直接替换</td>
</tr>
<tr>
<td>shareTo</td>
<td>share</td>
<td>直接替换</td>
</tr>
<tr>
<td>showPhoto</td>
<td>showPhoto</td>
<td>直接替换</td>
</tr>
<tr>
<td>stopMusic(android only)</td>
<td>stopMusic</td>
<td>直接替换</td>
</tr>
</tbody></table>

<h2 id="需要修改业务逻辑的方法">需要修改业务逻辑的方法</h2>

<ul>
<li><p><code class="prettyprint">takePhoto</code> <code class="prettyprint">takePhotoByName</code></p>

<p>判断版本，在3.6.0及以上版本使用<code class="prettyprint">uploadImage</code>代替，如果要兼容efte.js和dpmerchant，需要写两套业务代码。</p></li>
</ul>
<pre class="highlight javascript"><code><span class="k">if</span> <span class="p">(</span><span class="nx">ua</span><span class="p">.</span><span class="nx">appVersion</span> <span class="o">===</span> <span class="s1">'efte-1.0'</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">Efte</span> <span class="o">=</span> <span class="nx">DPMer</span><span class="p">.</span><span class="nx">_efte</span><span class="p">;</span> <span class="c1">// 只在efte webview下才会出现的efte的一个副本</span>
    <span class="c1">// use Efte.takePhoto</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// use DPMer.uploadImage</span>
<span class="p">}</span>
</code></pre>

<ul>
<li><p><code class="prettyprint">setTopRightProgress</code></p>

<p>新版本不支持，需改用其他交互方式。</p></li>
<li><p><code class="prettyprint">disableBounce</code></p>

<p>新版本不支持。</p></li>
<li><p><code class="prettyprint">checkDeal</code> <code class="prettyprint">setBadge</code></p>

<p>直接替换为DPMer.checkDeal()和DPMer.setBadge()。</p></li>
</ul>

<h2 id="关于点评管家web-scheme">关于点评管家web scheme</h2>

<p>点评管家<code class="prettyprint">3.6.0</code>版本新增了scheme：<code class="prettyprint">dpmer://newweb</code>。这个scheme主要用于从efte到dpmerchant的过渡阶段。过渡阶段的版本内，<code class="prettyprint">dpmer://newweb</code>对应支持dpmerchant的webview，<code class="prettyprint">dpmer://web</code>对应支持efte的webview。</p>

<p>对于前端项目，业务在js中使用<code class="prettyprint">openScheme</code>或<code class="prettyprint">jumpToScheme</code>时，<code class="prettyprint">dpmer://web</code>的scheme会被自动替换为<code class="prettyprint">dpmer://newweb</code>。</p>

<p>如果需要强制打开efte webview，则需要添加一个额外参数。如代码所示。</p>
<pre class="highlight javascript"><code><span class="nx">DPMer</span><span class="p">.</span><span class="nx">openScheme</span><span class="p">({</span>
    <span class="na">url</span><span class="p">:</span> <span class="s1">'dpmer://web'</span><span class="p">,</span>
    <span class="na">extra</span><span class="p">:</span> <span class="p">{</span> <span class="na">url</span><span class="p">:</span> <span class="s1">'http://m.dianping.com'</span> <span class="p">},</span>
    <span class="na">useEfteWeb</span><span class="p">:</span> <span class="kc">true</span> <span class="c1">// 传true表示使用efte webview打开</span>
<span class="p">});</span>
</code></pre>

<aside class="warning">
未来移除efte后的点评管家中，`dpmer://web`将指向新的webview。因此为了将来版本能够无缝升级，业务不应在代码里直接使用`dpmer://newweb`的scheme。
</aside>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="javascript">javascript</a>
          </div>
      </div>
    </div>
  </body>
</html>
